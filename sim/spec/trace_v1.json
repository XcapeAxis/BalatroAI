{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "sim/spec/trace_v1.json",
  "title": "Trace Line v1",
  "type": "object",
  "required": [
    "schema_version",
    "step_id",
    "phase",
    "action",
    "state_hash_full",
    "state_hash_hand_core",
    "reward",
    "done",
    "info"
  ],
  "properties": {
    "schema_version": {
      "const": "trace_v1"
    },
    "step_id": {
      "type": "integer",
      "minimum": 0
    },
    "phase": {
      "type": "string"
    },
    "action": {
      "type": "object"
    },
    "state_hash_full": {
      "type": "string"
    },
    "state_hash_hand_core": {
      "type": "string"
    },
    "state_hash_score_core": {
      "type": "string"
    },
    "state_hash_p0_hand_score_core": {
      "type": "string"
    },
    "state_hash_zones_core": {
      "type": "string"
    },
    "state_hash_zones_counts_core": {
      "type": "string"
    },
    "state_hash_economy_core": {
      "type": "string"
    },
    "state_hash_rng_events_core": {
      "type": "string"
    },
    "reward": {
      "type": "number"
    },
    "done": {
      "type": "boolean"
    },
    "info": {
      "type": "object"
    },
    "canonical_state_snapshot": {
      "type": "object"
    },
    "score_observed": {
      "type": "object",
      "properties": {
        "source_field": {
          "type": "string"
        },
        "pre_total": {
          "type": "number"
        },
        "total": {
          "type": "number"
        },
        "delta": {
          "type": "number"
        }
      }
    },
    "state_hash_p0_hand_score_observed_core": {
      "type": "string"
    },
    "rng_replay": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "source": {
          "type": "string"
        },
        "outcomes": {
          "type": "array"
        }
      }
    },
    "computed_expected": {
      "type": "object",
      "properties": {
        "available": {
          "type": "boolean"
        },
        "action_type": {
          "type": "string"
        },
        "hand_type": {
          "type": "string"
        },
        "base_chips": {
          "type": "number"
        },
        "base_mult": {
          "type": "number"
        },
        "score": {
          "type": "number"
        },
        "source_csv": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "reason": {
          "type": "string"
        },
        "score_core": {
          "type": "number"
        },
        "score_joker_delta": {
          "type": "number"
        },
        "score_total_expected": {
          "type": "number"
        },
        "effective_mult": {
          "type": "number"
        },
        "joker_bonus_chips": {
          "type": "number"
        },
        "joker_bonus_mult_add": {
          "type": "number"
        },
        "joker_bonus_mult_scale": {
          "type": "number"
        },
        "joker_breakdown": {
          "type": "array",
          "items": {
            "type": "object"
          }
        }
      }
    },
    "state_hash_p1_hand_score_observed_core": {
      "type": "string"
    },
    "state_hash_p2_hand_score_observed_core": {
      "type": "string"
    },
    "state_hash_p3_hand_score_observed_core": {
      "type": "string"
    },
    "state_hash_p2b_hand_score_observed_core": {
      "type": "string"
    },
    "state_hash_p4_consumable_observed_core": {
      "type": "string"
    },
    "state_hash_p5_modifier_observed_core": {
      "type": "string"
    },
    "state_hash_p5_voucher_pack_observed_core": {
      "type": "string"
    },
    "state_hash_p7_stateful_observed_core": {
      "type": "string"
    },
    "state_hash_p8_shop_observed_core": {
      "type": "string"
    },
    "state_hash_p8_rng_observed_core": {
      "type": "string"
    },
    "state_hash_p9_episode_observed_core": {
      "type": "string"
    },
    "state_hash_p10_long_episode_observed_core": {
      "type": "string"
    }
  }
}
